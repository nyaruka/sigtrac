{% extends "public/public_frame.html" %}

{% block content %}

#body-bar.row
  .col-sm-4
    #mtn-header.summary-header
    #mtn-body.summary-body
      .row
        .col-md-9.right-padding-5
          %h1.body-value.big-value
            [[averages.0.current.mtn.download_speed|number:0]]
        .col-md-3.left-padding-5
          .big-label kbps
      .row
        .col-xs-4
          %h2.pull-right.body-value
            [[averages.0.current.mtn.ping|number:0]]
            %span.small ms

        .col-xs-4
          %h2.pull-right.body-value
            [[averages.0.current.mtn.packets_dropped|number:0]]
            %span.small %

        .col-xs-4
          %h2.pull-right.body-value
            [[averages.0.current.mtn.report_count|number:0]] / [[ averages.0.current.mtn.device_count|number:0]]

  .col-sm-4
    #tigo-header.summary-header
    #tigo-body.summary-body
      .row
        .col-md-9.right-padding-5
          %h1.body-value.big-value
            [[averages.0.current.tigo.download_speed|number:0]]
        .col-md-3.left-padding-5
          .big-label kbps

      .row
        .col-xs-4
          %h2.pull-right.body-value
            [[averages.0.current.tigo.ping|number:0]]
            %span.small ms

        .col-xs-4
          %h2.pull-right.body-value
            [[averages.0.current.tigo.packets_dropped|number:0]]
            %span.small %

        .col-xs-4
          %h2.pull-right.body-value
            [[averages.0.current.tigo.report_count|number:0]] / [[ averages.0.current.tigo.device_count|number:0]]

  .col-sm-4
    #airtel-header.summary-header
    #airtel-body.summary-body
      .row
        .col-md-9.right-padding-5
          %h1.body-value.big-value
            [[averages.0.current.airtel.download_speed|number:0]]
        .col-md-3.left-padding-5
          .big-label kbps

      .row
        .col-xs-4
          %h2.pull-right.body-value
            [[averages.0.current.airtel.ping|number:0]]
            %span.small ms

        .col-xs-4
          %h2.pull-right.body-value
            [[averages.0.current.airtel.packets_dropped|number:0]]
            %span.small %

        .col-xs-4
          %h2.pull-right.body-value
            [[averages.0.current.airtel.report_count|number:0]] / [[ averages.0.current.airtel.device_count|number:0]]

.row
  .col-md-4.col-md-offset-4.text-center
    #time-buttons.btn-group
      <button class="btn btn-default" type="button" ng-click="averages[0]['current'] = averages[0]['hour'];">Hour</button>
      <button class="btn btn-default" type="button" ng-click="averages[0]['current'] = averages[0]['day'];">Day</button>
      <button class="btn btn-default" type="button" ng-click="averages[0]['current'] = averages[0]['week'];">Week</button>

.row
  #chart-spacer

#map.map

<script src="//api.tiles.mapbox.com/mapbox.js/v1.3.1/mapbox.js"></script>
<script type='text/javascript'>
var map = L.mapbox.map('map', 'thebenedict.map-hb5e1j6u');
</script>


{% endblock content %}

{% block bottom %}
#chart
{% endblock bottom %}

:css
  #chart {
    height: 200px;
  }


{% block extra-script %}

:javascript
  $(function () {
        $('#chart').highcharts({
            chart: {
                backgroundColor: null,
                type: 'column',
                height: 200,
                marginBottom: 1
            },
            plotOptions: {
                column: {
                    pointPadding: 0,
                    borderWidth: 0,
                    pointWidth: 13
                }
            },
            legend: {
                enabled: false,
            },
            credits: {
                enabled: false,
            },
            title: {
                text: null,
            },
            xAxis: {
                type: 'datetime',
                labels: {
                    enabled: false,
                }
            },
            yAxis: {
                title: {
                    text: null
                },
                min: 0,
                linkedTo: 0,
            },
            tooltip: {
                formatter: function() {
                        return '<b>'+ this.series.name +'</b><br/>'+
                        'was ' + this.y + ' kbps' + ' at ' + Highcharts.dateFormat('%H:%M', this.x);
                }
            },

            series: [
               {% for stats in time_data %}
               {
               name: '{{stats.carrier|safe}}',
               color: '{{stats.color|safe}}',
               pointWidth: 12,
               data: [
               {% for elt in stats.series %}
               [
               {% for unit in elt %}
               {% if forloop.first %}Date.parse("{{ unit }}"){%else%}{{unit}}{% endif %}
               {% if not forloop.last %},{% endif %}
               {% endfor %}
               ]
               {% if not forloop.last %},{% endif %}
               {% endfor %}
               ]
               }
               {% if not forloop.last %},{% endif %}
               {% endfor %}

            ]
        });
    });

{% endblock extra-script %}

